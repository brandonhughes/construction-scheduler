{"ast":null,"code":"/**\n * Global Inactivity Tracker\n * This is a window-level inactivity tracking system that works independently of React components.\n */\n\n// Configuration\nconst INACTIVITY_TIMEOUT = 15 * 60 * 1000; // 15 minutes\nconst WARNING_DURATION = 60 * 1000; // 60 seconds\n\n// Events to track for user activity\nconst USER_ACTIVITY_EVENTS = ['mousedown', 'mousemove', 'keydown', 'scroll', 'touchstart', 'click'];\n\n// Global state\nlet inactivityTimer = null;\nlet warningTimer = null;\nlet warningCallback = null;\nlet logoutCallback = null;\nlet isWarningShown = false;\nlet warningTimeout = 0;\nlet isInitialized = false;\n\n// Utility to reset timers\nconst resetInactivityTimer = () => {\n  // Clear existing timers\n  if (inactivityTimer) {\n    clearTimeout(inactivityTimer);\n  }\n\n  // Don't reset warning timer if warning is showing\n  if (isWarningShown) {\n    return;\n  }\n\n  // Clear warning timer\n  if (warningTimer) {\n    clearTimeout(warningTimer);\n  }\n\n  // Hide warning if it's showing\n  if (isWarningShown) {\n    isWarningShown = false;\n    if (warningCallback) {\n      warningCallback(false, 0);\n    }\n  }\n\n  // Set new inactivity timer\n  inactivityTimer = setTimeout(() => {\n    // Show warning\n    isWarningShown = true;\n    warningTimeout = Date.now() + WARNING_DURATION;\n    if (warningCallback) {\n      warningCallback(true, warningTimeout);\n    }\n\n    // Set warning timer\n    warningTimer = setTimeout(() => {\n      // Reset state\n      isWarningShown = false;\n\n      // Execute logout callback\n      if (logoutCallback) {\n        logoutCallback();\n      }\n    }, WARNING_DURATION);\n  }, INACTIVITY_TIMEOUT);\n};\n\n// User activity event handler\nconst handleUserActivity = () => {\n  // Only reset if warning is not showing\n  if (!isWarningShown) {\n    resetInactivityTimer();\n  }\n};\n\n// Initialize the tracker\nexport const initInactivityTracker = (onWarning, onLogout) => {\n  // Only initialize once\n  if (isInitialized) {\n    warningCallback = onWarning;\n    logoutCallback = onLogout;\n    return;\n  }\n\n  // Store callbacks\n  warningCallback = onWarning;\n  logoutCallback = onLogout;\n\n  // Register all event listeners\n  USER_ACTIVITY_EVENTS.forEach(eventType => {\n    window.addEventListener(eventType, handleUserActivity, {\n      passive: true\n    });\n  });\n\n  // Initial timer setup\n  resetInactivityTimer();\n\n  // Mark as initialized\n  isInitialized = true;\n};\n\n// Clean up the tracker\nexport const cleanupInactivityTracker = () => {\n  // Remove event listeners\n  USER_ACTIVITY_EVENTS.forEach(eventType => {\n    window.removeEventListener(eventType, handleUserActivity);\n  });\n\n  // Clear timers\n  if (inactivityTimer) {\n    clearTimeout(inactivityTimer);\n    inactivityTimer = null;\n  }\n  if (warningTimer) {\n    clearTimeout(warningTimer);\n    warningTimer = null;\n  }\n\n  // Reset state\n  isWarningShown = false;\n  warningCallback = null;\n  logoutCallback = null;\n  isInitialized = false;\n};\n\n// Continue session (dismiss warning)\nexport const continueSession = () => {\n  isWarningShown = false;\n  if (warningCallback) {\n    warningCallback(false, 0);\n  }\n  resetInactivityTimer();\n};","map":{"version":3,"names":["INACTIVITY_TIMEOUT","WARNING_DURATION","USER_ACTIVITY_EVENTS","inactivityTimer","warningTimer","warningCallback","logoutCallback","isWarningShown","warningTimeout","isInitialized","resetInactivityTimer","clearTimeout","setTimeout","Date","now","handleUserActivity","initInactivityTracker","onWarning","onLogout","forEach","eventType","window","addEventListener","passive","cleanupInactivityTracker","removeEventListener","continueSession"],"sources":["/Users/brandonhughes/Construction-Scheduler/client/src/services/inactivity-tracker.js"],"sourcesContent":["/**\n * Global Inactivity Tracker\n * This is a window-level inactivity tracking system that works independently of React components.\n */\n\n// Configuration\nconst INACTIVITY_TIMEOUT = 15 * 60 * 1000; // 15 minutes\nconst WARNING_DURATION = 60 * 1000; // 60 seconds\n\n// Events to track for user activity\nconst USER_ACTIVITY_EVENTS = [\n  'mousedown', 'mousemove', 'keydown', \n  'scroll', 'touchstart', 'click'\n];\n\n// Global state\nlet inactivityTimer = null;\nlet warningTimer = null;\nlet warningCallback = null;\nlet logoutCallback = null;\nlet isWarningShown = false;\nlet warningTimeout = 0;\nlet isInitialized = false;\n\n// Utility to reset timers\nconst resetInactivityTimer = () => {\n  // Clear existing timers\n  if (inactivityTimer) {\n    clearTimeout(inactivityTimer);\n  }\n  \n  // Don't reset warning timer if warning is showing\n  if (isWarningShown) {\n    return;\n  }\n  \n  // Clear warning timer\n  if (warningTimer) {\n    clearTimeout(warningTimer);\n  }\n  \n  // Hide warning if it's showing\n  if (isWarningShown) {\n    isWarningShown = false;\n    if (warningCallback) {\n      warningCallback(false, 0);\n    }\n  }\n  \n  // Set new inactivity timer\n  inactivityTimer = setTimeout(() => {\n    // Show warning\n    isWarningShown = true;\n    warningTimeout = Date.now() + WARNING_DURATION;\n    \n    if (warningCallback) {\n      warningCallback(true, warningTimeout);\n    }\n    \n    // Set warning timer\n    warningTimer = setTimeout(() => {\n      // Reset state\n      isWarningShown = false;\n      \n      // Execute logout callback\n      if (logoutCallback) {\n        logoutCallback();\n      }\n    }, WARNING_DURATION);\n    \n  }, INACTIVITY_TIMEOUT);\n};\n\n// User activity event handler\nconst handleUserActivity = () => {\n  // Only reset if warning is not showing\n  if (!isWarningShown) {\n    resetInactivityTimer();\n  }\n};\n\n// Initialize the tracker\nexport const initInactivityTracker = (onWarning, onLogout) => {\n  // Only initialize once\n  if (isInitialized) {\n    warningCallback = onWarning;\n    logoutCallback = onLogout;\n    return;\n  }\n  \n  // Store callbacks\n  warningCallback = onWarning;\n  logoutCallback = onLogout;\n  \n  // Register all event listeners\n  USER_ACTIVITY_EVENTS.forEach(eventType => {\n    window.addEventListener(eventType, handleUserActivity, { passive: true });\n  });\n  \n  // Initial timer setup\n  resetInactivityTimer();\n  \n  // Mark as initialized\n  isInitialized = true;\n};\n\n// Clean up the tracker\nexport const cleanupInactivityTracker = () => {\n  // Remove event listeners\n  USER_ACTIVITY_EVENTS.forEach(eventType => {\n    window.removeEventListener(eventType, handleUserActivity);\n  });\n  \n  // Clear timers\n  if (inactivityTimer) {\n    clearTimeout(inactivityTimer);\n    inactivityTimer = null;\n  }\n  \n  if (warningTimer) {\n    clearTimeout(warningTimer);\n    warningTimer = null;\n  }\n  \n  // Reset state\n  isWarningShown = false;\n  warningCallback = null;\n  logoutCallback = null;\n  isInitialized = false;\n};\n\n// Continue session (dismiss warning)\nexport const continueSession = () => {\n  isWarningShown = false;\n  \n  if (warningCallback) {\n    warningCallback(false, 0);\n  }\n  \n  resetInactivityTimer();\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}